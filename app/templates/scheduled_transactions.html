{% extends 'common/layout.html' %}
{% block css %}
    <link href="{{ url_for('static', filename='css/bootstrap-dialog.css') }}" rel="stylesheet">
{% endblock %}
{% block body %}
	<div class="page-header">
		<h3>Scheduled transactions &nbsp;&nbsp;
		<div class="btn-group">
		  <button type="button" class="btn btn btn-info btn-xs dropdown-toggle" data-toggle="dropdown">
		    <i class="fa fa-plus"></i>
		  </button>
		  <ul class="dropdown-menu" role="menu">
		    <li><a href="/add_scheduled_transaction/debit">
		    	<span class="label label-danger">
		    		<i class="fa fa-minus fa-fw"></i>
		    	</span>&nbsp;&nbsp;debit
		    </a></li>
		    <li><a href="/add_scheduled_transaction/credit">
		    	<span class="label label-success">
		    		<i class="fa fa-plus fa-fw"></i>
		    	</span>&nbsp;&nbsp;credit
		    </a></li>
		    <li><a href="/add_scheduled_transaction/transfer">
		    	<span class="label label-primary">
		    		<i class="fa fa-exchange fa-fw"></i>
		    	</span>&nbsp;&nbsp;transfer
		    </a></li>
		  </ul>
		</div>
		</h3>
	</div>
	{% for transaction in scheduled_transactions %}
	<div class="col-sm-6">
		<div class="panel panel-default">
			<div class="panel-heading">
			    <h3 class="panel-title">{% if transaction.next_occurence <= now %} <i class="fa fa-exclamation-triangle"></i>{% endif %} {{ transaction.description }}
			    <div class="btn-toolbar pull-right" role="toolbar">
			    	<div class="btn-group btn-group-xs">
						<a href="/info_scheduled_transaction/{{ transaction.id }}" class="btn btn-info" role="button"><i class="fa fa-info"></i></a>
					</div>
					<div class="btn-group btn-group-xs">
						<a href="/edit_scheduled_transaction/{{ transaction.id }}" class="btn btn-default" role="button"><i class="fa fa-edit"></i></a>
						<a href="/delete_scheduled_transaction/{{ transaction.id }}" class="btn btn-danger confirmdelete" role="button"><i class="fa fa-trash-o"></i></a>
					</div>
				</div>
				</h3>
			</div>
			<div class="panel-body">
			    <!-- next occurence -->
			    <div class="row">
			      <div class="col-sm-4 text-right">
			        <small><strong>next occurence</strong></small>
			      </div>
			      <div class="col-sm-8">
			          {{ transaction.next_occurence.strftime('%d/%m/%Y') }}
			      </div>
			    </div>
			    <!-- amount -->
				<div class="row">
			      <div class="col-sm-4 text-right">
			        <small><strong>amount</strong></small>
			      </div>
			      <div class="col-sm-8">
			      	  {{ "%.2f"| format(transaction.amount) }} &nbsp;<i class="fa fa-gbp"></i>
			      </div>
				</div>
				<!-- every -->
				<div class="row">
			      <div class="col-sm-4 text-right">
			        <small><strong>every</strong></small>
			      </div>
			      <div class="col-sm-8">
			      	  month
			      </div>
				</div>
				<div class="btn-group btn-group-xs pull-right">
					<a href="/create_scheduled_transaction/{{ transaction.id }}" class="btn btn-primary" role="button">create</a>
					<a href="/skip_scheduled_transaction/{{ transaction.id }}" class="btn btn-default" role="button">skip</a>
				</div>
			</div>
		</div>
	</div>
	{% endfor %}
{% endblock body %}
{% block javascript %}
	<script src="{{ url_for('static', filename='js/bootstrap-dialog.min.js') }}"></script>
    <script type='text/javascript'>
        $(document).on("click", ".confirmdelete", function(e) {
            var link = $(this).attr("href"); // "get" the intended link in a var
            e.preventDefault();
            new BootstrapDialog.show({
                type: 'type-danger',
                title: 'Delete Scheduled Transaction',
                message: 'Are you sure that you want to delete this scheduled transaction?',
                buttons: [{ label: 'Cancel',
                            cssClass: 'btn-default',
                            action: function(dialogRef) {
                                dialogRef.close()
                            }}, 
                          { label: 'Yes',
                            cssClass: 'btn-danger',
                            action: function(result) {
                                if (result) {
                                    document.location.href = link;
                                } 
                            }}]
            });
        });
    </script>
{% endblock javascript %}