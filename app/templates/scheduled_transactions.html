{% extends 'common/layout.html' %}
{% block css %}
    <link href="{{ url_for('static', filename='css/bootstrap-dialog.css') }}" rel="stylesheet">
{% endblock %}
{% block body %}
	<div class="page-header">
		<h3>Scheduled transactions</h3>
	</div>
	{% for transaction in scheduled_transactions %}
	<div class="col-sm-6">
		<div class="panel panel-default">
			<div class="panel-heading">
			    <h3 class="panel-title">{% if transaction.next_occurence <= now %} <i class="fa fa-exclamation-triangle"></i>{% endif %} {{ transaction.description }}</h3>
			</div>
			<div class="panel-body">
			    <!-- next occurence -->
			    <div class="row">
			      <div class="col-sm-4 text-right">
			        <small><strong>next occurence</strong></small>
			      </div>
			      <div class="col-sm-8">
			          {{ transaction.next_occurence.strftime('%d/%m/%Y') }}
			      </div>
			    </div>
			    <!-- amount -->
				<div class="row">
			      <div class="col-sm-4 text-right">
			        <small><strong>amount</strong></small>
			      </div>
			      <div class="col-sm-8">
			      	<span class="label label-{% if transaction.amount > 0 %}success{% else %}danger{% endif %}">
			          {{ transaction.amount }}
			      	</span>
			      </div>
				</div>
				<div class="btn-group btn-group-xs pull-right">
					<a href="/edit_scheduled_transaction/{{ transaction.id }}" class="btn btn-default" role="button"><i class="fa fa-edit"></i></a>
					<a href="/delete_scheduled_transaction/{{ transaction.id }}" class="btn btn-default confirmdelete" role="button"><i class="fa fa-trash-o"></i></a>
				</div>
			</div>
		</div>
	</div>
	{% endfor %}
{% endblock body %}
{% block javascript %}
	<script src="{{ url_for('static', filename='js/bootstrap-dialog.min.js') }}"></script>
    <script type='text/javascript'>
        $(document).on("click", ".confirmdelete", function(e) {
            var link = $(this).attr("href"); // "get" the intended link in a var
            e.preventDefault();
            new BootstrapDialog.show({
                type: 'type-danger',
                title: 'Delete Scheduled Transaction',
                message: 'Are you sure that you want to delete this scheduled transaction?',
                buttons: [{ label: 'Cancel',
                            cssClass: 'btn-default',
                            action: function(dialogRef) {
                                dialogRef.close()
                            }}, 
                          { label: 'Yes',
                            cssClass: 'btn-danger',
                            action: function(result) {
                                if (result) {
                                    document.location.href = link;
                                } 
                            }}]
            });
        });
    </script>
{% endblock javascript %}